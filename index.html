<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moldura ‚Äì Foto e V√≠deo</title>
  <style>
    body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    #cameraPreview { width: 100%; max-width: 420px; border-radius: 14px; background: #000; }
    #frameOverlay { position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; }
    #previewContainer { position: relative; width: 100%; max-width: 420px; }
    button { padding: 12px 18px; margin: 10px; border-radius: 10px; border: none; background: #0099ff; color: #fff; font-size: 16px; cursor: pointer; }
    canvas { display: none; }
  </style>
</head>
<body>
  <h2>Moldura ‚Äì Captura Foto e V√≠deo</h2>

  <div id="previewContainer">
    <video id="cameraPreview" autoplay playsinline></video>
    <img id="frameOverlay" src="moldura.png" />
  </div>

  <div>
    <button id="btnFoto">üì∏ Tirar Foto</button>
    <button id="btnVideoStart">üé• Iniciar V√≠deo</button>
    <button id="btnVideoStop" disabled>‚èπ Parar V√≠deo</button>
  </div>

  <canvas id="canvas"></canvas>

  <script>
    const video = document.getElementById("cameraPreview");
    const frame = document.getElementById("frameOverlay");
    const canvas = document.getElementById("canvas");

    let mediaStream = null;
    let recorder = null;
    let videoBlobs = [];

    async function iniciarCamera() {
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "user" },
          audio: { echoCancellation: true, noiseSuppression: true }
        });
        video.srcObject = mediaStream;
      } catch (e) {
        alert("Erro ao acessar a c√¢mera: " + e);
      }
    }

    window.onload = iniciarCamera;

    document.getElementById("btnFoto").onclick = () => {
      const w = video.videoWidth;
      const h = video.videoHeight;
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");

      ctx.drawImage(video, 0, 0, w, h);
      ctx.drawImage(frame, 0, 0, w, h);

      canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "foto_moldura.png";
        a.click();
      }, "image/png");
    };

    document.getElementById("btnVideoStart").onclick = () => {
      videoBlobs = [];

      const mimeOptions = [
        "video/webm;codecs=vp9,opus",
        "video/webm;codecs=vp8,opus",
        "video/webm",
        "video/mp4"
      ];

      let escolhido = mimeOptions.find(t => MediaRecorder.isTypeSupported(t));

      recorder = new MediaRecorder(mediaStream, { mimeType: escolhido });

      recorder.ondataavailable = (e) => videoBlobs.push(e.data);

      recorder.onstop = () => {
        const fullBlob = new Blob(videoBlobs, { type: escolhido });
        const url = URL.createObjectURL(fullBlob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "video_moldura" + (escolhido.includes("webm") ? ".webm" : ".mp4");
        a.click();
      };

      recorder.start();
      document.getElementById("btnVideoStart").disabled = true;
      document.getElementById("btnVideoStop").disabled = false;
    };

    document.getElementById("btnVideoStop").onclick = () => {
      recorder.stop();
      document.getElementById("btnVideoStart").disabled = false;
      document.getElementById("btnVideoStop").disabled = true;
    };
  </script>
</body>
</html>
